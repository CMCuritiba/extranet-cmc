
/* Merged Plone Javascript file
 * This file is dynamically assembled from separate parts.
 * Some of these parts have 3rd party licenses or copyright information attached
 * Such information is valid for that section,
 * not for the entire composite file
 * originating files are separated by - filename.js -
 */

/* - ++resource++collective.polls/js/polls.js - */
// https://www.curitiba.pr.leg.br/portal_javascripts/++resource++collective.polls/js/polls.js?original=1
!function($){"use strict";var Poll=function(element,options){this.init('polls',element,options)};Poll.prototype={constructor:Poll,init:function(type,element,options){this.type=type;this.e=$(element);this.options=this.get_options(options);if(this.options.type=='bar'){this.setup_bars_poll()}if(this.options.type=='pie'){this.setup_pie_poll()}},get_options:function(options){options=$.extend({},$.fn[this.type].defaults,options,this.e.data());return options},_1:function(bar_data){var label=$('<span/>').addClass('bar-label');var bar=$('<div/>').addClass('bar');var vote_counter=$('<span/>').append(' ('+bar_data['value']+')');var bar_row=$('<div/>').addClass('bar-row');bar_row.data('bar_row_value',bar_data['value']);var bg=bar_data['color'];label.html(bar_data['label']);if(!this.options['show_labels']){label.css('display','none')}if(this.options['show_votes']){label.append(vote_counter)}bar.css({'background-color':bg,'height':this.options['bars_height'],'display':'block'});bar_row.css({'margin-bottom':this.options['bars_separation']});bar_row.append(label).append(bar);return bar_row},_0:function(total_votes){var global_this=this;var rows=this.e.find('.bar-row');var max_width=this.options['width']?this.options['width']:this.e.width();rows.each(function(){var t=$(this);var porcentual=100/total_votes * t.data('bar_row_value');var porcentual_real_str=(porcentual+'').substring(0,4)+' %';t.find('.bar').css({'width':max_width/100 * porcentual+'px'});if(global_this.options['show_porcentual']){t.find('.bar').append($('<span/>').html(porcentual_real_str))}})},setup_bars_poll:function(){var data=this.options.data;var bar={};var label='label';var total_votes=0;for(var i=0,len=data.length;i<len;i++){var d=data[i];if(typeof d=="number"){bar['value']=d}else{bar['value']=d['data']}bar['label']=d['label']?d['label']:label+i;bar['color']=d['color'];if(!d['color']){bar['color']=this.options['colors'][i]}total_votes+=bar['value'];var bar_row=this._1(bar);this.e.append(bar_row)}this._0(total_votes)},setup_pie_poll:function(){var data=this.options.data;$.plot(this.e,data,{series:{pie:{show:true}},legend:{show:this.options.show_labels}})}};$.fn.polls=function(option){return this.each(function(){var t=$(this),data=t.data('polls'),options=typeof option=='object'&&option;if(!data)t.data('polls',(data=new Poll(this,options)));if(typeof option=='string')data[option]()})};$.fn.polls.Constructor=Poll;$.fn.polls.defaults={type:'bar',width:undefined,bars_height:'14px',bars_separation:'10px',show_labels:true,show_votes:true,show_porcentual:true,colors:['#599B10','#008B88','#009ADD','#F1AD00','#FA5600','#F8002A','#599B10','#008B88','#009ADD','#F1AD00','#FA5600','#F8002A'],data:[]}}(window.jQuery);

/* - ++resource++collective.polls/js/collective.poll.js - */
// https://www.curitiba.pr.leg.br/portal_javascripts/++resource++collective.polls/js/collective.poll.js?original=1
!function($){"use strict";var DrawPoll=function(element,options){this.init(element)};DrawPoll.prototype={constructor:DrawPoll,init:function(poll){this.poll=$(poll);this.ajax_submit();this.content_handler=this.get_handler();if(this.content_handler[0]!==undefined){this.type=this.get_type();this.data=this.get_data();this.extra_conf={'width':undefined};switch(this.type){case 'portlet':this.setup_portlet(this.data.type);break;default:this.setup_default(this.data.type)}this.draw(this.data,this.content_handler,this.extra_conf)}},draw:function(data,content_handler,extra_conf){content_handler.polls({width:extra_conf.width,type:data.type,data:data.result_data})},get_data:function(poll){var poll=poll!==undefined?poll:this.poll,raw_results=poll.find('.poll-results'),result={},result_data=[];raw_results.find('li').each(function(i){var li=$(this),data={};data['label']=li.find('.option_description').text();data['data']=li.find('.option_result').text()*1;result_data[i]=data});result['type']=this.get_graph_type(poll);result['result_data']=result_data;raw_results.hide();return result},get_handler:function(poll){var poll=poll!==undefined?poll:this.poll,handler=poll.find('[class*=pollresultholder]');return handler},get_type:function(handler){var handler=handler!==undefined?handler:this.content_handler,re=/\w+(?=pollresultholder)/,match=handler.attr('class').match(re),type=match?match[0]:match;if(type===undefined){type='default'}return type},get_graph_type:function(poll){var poll=poll!==undefined?poll:this.poll,re=/\w+(?=-poll)/,match=poll.attr('class').match(re),type=match?match[0]:match;return type},setup_portlet:function(type){if(type=='pie'){this.content_handler.height(150)}},setup_default:function(type){var width=350;switch(type){case 'pie':this.content_handler.height(200);this.content_handler.width(width);break;case 'bar':width=300;this.content_handler.width(width);break}this.extra_conf['width']=width},ajax_submit:function(){this.poll.submit(function(event){var t=$(this);var p=t.parents('.votePortlet');var url=t.attr('action');var data=t.serialize()+'&ajax_load=True&poll.submit=True';$('.poll-spinner',p).show();t.css({'visibility':'hidden'});$.ajax({url:url,data:data,type:'POST',success:function(html){var manager=''
if(p[0]!==undefined){manager=p.attr('data-manager')}if(!manager){window.location=window.location}else{var base=p.attr('data-url');if(!base){base='.'}$.ajax({url:base+'/@@poll_portlet_render',data:{'column':manager},success:function(data){p.replaceWith(data);$('.poll-data').drawpoll();$('.spinner',p).hide()}})}}});return false})}};$.fn.drawpoll=function(option){return this.each(function(){var t=$(this),data=t.data('drawpoll'),options=typeof option=='object'&&option;if(!data)t.data('drawpoll',(data=new DrawPoll(this,options)));if(typeof option=='string')data[option]()})};$.fn.drawpoll.Constructor=DrawPoll;$(function(){$('.poll-data, .votePortlet form').drawpoll()})}(window.jQuery);
